#!/usr/bin/env node
// Generates the MathJax font loaders file for Vite bundling
// Run: node scripts/generate-font-loaders.mjs

import { promises as fs } from 'node:fs';
import path from 'node:path';

const fontDir = 'node_modules/@mathjax/mathjax-newcm-font/mjs/svg/dynamic';
const outputFile = 'src/lib/workers/mathjax-font-loaders.generated.js';

async function generate() {
  const files = await fs.readdir(fontDir);
  const jsFiles = files.filter(f => f.endsWith('.js')).sort();

  const entries = jsFiles.map(file => {
    const name = path.basename(file, '.js');
    const spec = `@mathjax/mathjax-newcm-font/mjs/svg/dynamic/${file}`;
    return `  '${name}': () => import('${spec}')`;
  });

  const out = `// AUTO-GENERATED by scripts/generate-font-loaders.mjs - DO NOT EDIT
// Explicit loaders for MathJax dynamic fonts - Vite can statically analyze these
// Regenerate with: node scripts/generate-font-loaders.mjs

export const fontLoaders = {
${entries.join(',\n')}
};
`;

  await fs.writeFile(outputFile, out);
  console.log(`Generated ${outputFile} with ${jsFiles.length} font loaders`);
}

generate().catch(err => {
  console.error('Failed to generate font loaders:', err);
  process.exit(1);
});
